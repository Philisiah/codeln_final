{% extends 'partials/navigation.html' %}
{% block title %}
    Candidates
{% endblock %}
{% load static %}

{% block below_navigation %}
    <div class="w3-margin-top w3-hide-small"></div>
    <div class="w3-padding-small">
        <div class="columns is-centered">
            <div class="column is-three-fifths">
                <div class="card">
                    <div class="card-content">
                        <h1 class="menu-label w3-large w3-center">list of candidates</h1>
                        <table class="table">
                            <thead>

                            <tr>
                                <th>First name</th>
                                <th>Last name</th>
                                <th>Email</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for candidate in candidates %}
                                <tr>
                                    <td>{{ candidate.first_name }}</td>
                                    <td>{{ candidate.last_name }}</td>
                                    <td>{{ candidate.email }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <div>
                            <div class="level">
                                <div class="level-left">
                                    PAYMENT DUE
                                </div>
                                <div class="level-right has-text-weight-bold w3-large">
                                    USD {{ total_amount }}
                                </div>
                            </div>
                            <hr>

                            <form style="text-align: -webkit-center;">
                                <script src="https://api.ravepay.co/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script>
                                <script src="https://ravesandboxapi.flutterwave.com/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script>
                                <a onClick="payWithRave()" class="mdc-button mdc-button--raised">
                                    Make Payment
                                </a>

                            </form>
                            <br>
                            <div class="w3-center">
                                <img src="{% static 'frontend/images/rave.png' %}" alt="" width="300"
                                     class="w3-margin-top">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>


        const API_publicKey = "FLWPUBK-37320275f784b16ec1e30b1342c0a223-X";
        const SuccessUrl = '{% url 'payments:flutter-done' current_transaction.id %}';
        {#const CancelledUrl = window.location.origin + '{% url 'payments:canceled' transaction.id%}'#}

        function payWithRave() {
            var x = getpaidSetup({
                PBFPubKey: API_publicKey,
                customer_email: '{{ current_transaction.user.email }}',
                amount: {{current_transaction.amount}},
                customer_phone: "234099940409",
                currency: "USD",
                payment_method: "both",
                txref: {{ current_transaction.id }},
                meta: [{
                    metaname: "flightID",
                    metavalue: "AP1234"
                }],
                onclose: function () {
                    console.log('closed');
                    console.log(SuccessUrl);
                },
                callback: function (response) {
                    var txref = response.tx.txRef; // collect txRef returned and pass to a 					server page to complete status check.
                    console.log("This is the response returned after a charge", response);
                    if (
                        response.tx.chargeResponseCode === "00" ||
                        response.tx.chargeResponseCode === "0"
                    ) {

                        window.location.href = SuccessUrl;
                    } else {
                        // redirect to a failure page.
                        console.log('failed');
                        console.log(SuccessUrl);
                    }

                    x.close(); // use this to close the modal immediately after payment.
                }
            });
        }
    </script>

{% endblock %}
